<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lakeside Serenity in Davidson | Modern 2-Bedroom Rental</title>

    <!-- Librerías CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />

    <!-- Tu Hoja de Estilos -->
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <nav class="container">
        <a href="#home" class="nav-brand">Lakeside Serenity</a>

        <!-- Menú de escritorio (se ocultará en móvil) -->
        <ul class="nav-menu-desktop">
          <li><a href="#about">About</a></li>
          <li><a href="#amenities">Amenities</a></li>
          <li><a href="#gallery">Gallery</a></li>
          <li><a href="#location">Location</a></li>
          <li><a href="#reviews">Reviews</a></li>
          <li>
            <a href="#contact" class="btn btn-primary nav-btn">Reserve Now</a>
          </li>
        </ul>

        <!-- NUEVO: Botón de Hamburguesa (solo visible en móvil) -->
        <div class="nav-toggle" id="nav-toggle">
          <i class="fas fa-bars"></i>
        </div>

        <!-- NUEVO: Menú Desplegable Móvil (oculto por defecto) -->
        <div class="nav-menu-mobile" id="nav-menu-mobile">
          <ul class="nav-list-mobile">
            <li><a href="#about" class="nav-link-mobile">About</a></li>
            <li><a href="#amenities" class="nav-link-mobile">Amenities</a></li>
            <li><a href="#gallery" class="nav-link-mobile">Gallery</a></li>
            <li><a href="#location" class="nav-link-mobile">Location</a></li>
            <li>
              <a href="#reviews" class="nav-link-mobile">Reviews</a>
            </li>
          </ul>
          <div class="nav-close" id="nav-close">
            <i class="fas fa-times"></i>
          </div>
        </div>
      </nav>
    </header>

    <main>
      <!-- HERO SECTION -->
      <section id="home" class="hero">
        <div class="hero-video-wrapper">
          <video autoplay loop muted playsinline>
            <source src="videos/26.mp4" type="video/mp4" />
            <!-- Opcional: añade un MP4 como respaldo para navegadores muy viejos -->
            <!-- <source src="videos/26.mp4" type="video/mp4"> -->
          </video>
        </div>
        <div class="hero-overlay"></div>
        <div class="container">
          <h1></h1>
          <h2>A Modern 2-Bedroom Getaway with Stunning Lake Views</h2>
          <div class="hero-actions">
            <a href="#gallery" class="btn btn-primary">View Photo Gallery</a>
            <a href="#contact" class="btn btn-secondary">Reserve Now</a>
          </div>
        </div>
      </section>

      <!-- ABOUT THIS SPACE SECTION -->
      <section id="about" class="about-section">
        <div class="container about-container">
          <div class="about-text" data-aos="fade-right">
            <h2 class="section-title">Welcome to Your Lakeside Retreat</h2>
            <p>
              Nestled in a peaceful neighborhood, this property boasts 2
              bedrooms, 1 bathroom, and a cozy living room perfect for relaxing.
              Step out onto the deck to enjoy the stunning lake view.
            </p>
            <p>
              The location is ideal for exploring the charming town of Davidson.
              A short 20-minute drive takes you to Charlotte, and the airport is
              just 25 minutes away. We respond promptly to any requests and
              can't wait to host you!
            </p>
          </div>
          <div class="about-image" data-aos="fade-left">
            <img src="images/17.jpg" alt="A bright and inviting living space" />
          </div>
        </div>
      </section>

      <!-- AMENITIES SECTION -->
      <section id="amenities" class="bg-light">
        <div class="container">
          <h2 class="section-title">What This Place Offers</h2>
          <div class="amenities-grid">
            <div class="amenity-item">
              <i class="fas fa-bed"></i> 2 Bedrooms
            </div>
            <div class="amenity-item">
              <i class="fas fa-bath"></i> 1 Bathroom
            </div>
            <div class="amenity-item">
              <i class="fas fa-water"></i> Lake View Deck
            </div>
            <div class="amenity-item"><i class="fas fa-tv"></i> Smart TV</div>
            <div class="amenity-item">
              <i class="fas fa-wifi"></i> High-Speed Wi-Fi
            </div>
            <div class="amenity-item">
              <i class="fas fa-wind"></i> Air Conditioning
            </div>
            <div class="amenity-item">
              <i class="fas fa-car"></i> Free On-site Parking
            </div>
            <div class="amenity-item">
              <i class="fas fa-tshirt"></i> Washer & Dryer
            </div>
            <div class="amenity-item">
              <i class="fas fa-utensils"></i> Full Kitchen
            </div>
            <div class="amenity-item">
              <i class="fas fa-city"></i> 20-min to Charlotte
            </div>
            <div class="amenity-item">
              <i class="fas fa-plane"></i> 25-min to Airport
            </div>
            <div class="amenity-item">
              <i class="fas fa-store"></i> Near Davidson Town
            </div>
          </div>
        </div>
      </section>

      <!-- PHOTO GALLERY SLIDER SECTION -->
      <section id="gallery">
        <div class="container">
          <h2 class="section-title">Explore the Property</h2>
          <div class="swiper mySwiper" data-aos="zoom-in">
            <div class="swiper-wrapper">
              <div class="swiper-slide">
                <img src="images/1.jpg" alt="Gallery Image 1" />
              </div>
              <div class="swiper-slide">
                <img src="images/2.jpg" alt="Gallery Image 2" />
              </div>
              <div class="swiper-slide">
                <img src="images/3.jpg" alt="Gallery Image 3" />
              </div>
              <div class="swiper-slide">
                <img src="images/4.jpg" alt="4" />
              </div>
              <div class="swiper-slide">
                <img src="images/5.jpg" alt="5" />
              </div>
              <div class="swiper-slide">
                <img src="images/6.jpg" alt="6" />
              </div>
              <div class="swiper-slide">
                <img src="images/7.jpg" alt="7" />
              </div>
              <div class="swiper-slide">
                <img src="images/8.jpg" alt="8" />
              </div>
              <div class="swiper-slide">
                <img src="images/9.jpg" alt="9" />
              </div>
              <div class="swiper-slide">
                <img src="images/10.jpg" alt="10" />
              </div>
              <div class="swiper-slide">
                <img src="images/11.jpg" alt="11" />
              </div>
              <div class="swiper-slide">
                <img src="images/12.jpg" alt="12" />
              </div>
              <div class="swiper-slide">
                <img src="images/13.jpg" alt="13" />
              </div>
              <div class="swiper-slide">
                <img src="images/14.jpg" alt="14" />
              </div>
              <div class="swiper-slide">
                <img src="images/15.jpg" alt="15" />
              </div>
              <div class="swiper-slide">
                <img src="images/16.jpg" alt="16" />
              </div>
              <div class="swiper-slide">
                <img src="images/17.jpg" alt="17" />
              </div>
              <div class="swiper-slide">
                <img src="images/18.jpg" alt="18" />
              </div>
              <div class="swiper-slide">
                <img src="images/19.jpg" alt="19" />
              </div>
              <div class="swiper-slide">
                <img src="images/20.jpg" alt="20" />
              </div>
              <div class="swiper-slide">
                <img src="images/21.jpg" alt="21" />
              </div>
              <div class="swiper-slide">
                <img src="images/22.jpg" alt="22" />
              </div>
              <div class="swiper-slide">
                <img src="images/23.jpg" alt="23" />
              </div>
              <div class="swiper-slide">
                <img src="images/24.jpg" alt="24" />
              </div>
              <div class="swiper-slide">
                <img src="images/25.jpg" alt="25" />
              </div>
            </div>
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-pagination"></div>
          </div>
        </div>
      </section>

      <!-- LOCATION SECTION -->
      <section id="location" class="bg-light">
        <div class="container">
          <h2 class="section-title">Prime Location</h2>
          <div class="map-container" data-aos="fade-up">
            <iframe
              src="https://maps.app.goo.gl/T9p4JThqYgZkWd389"
              width="100%"
              height="450"
              style="border: 0"
              allowfullscreen=""
              loading="lazy"
            ></iframe>
          </div>
        </div>
      </section>

      <section id="reviews" class="reviews-section">
        <div class="container">
          <h2 class="section-title">What Our Guests Say</h2>
          <p>
            Don't just take our word for it! Here are some of the wonderful
            things our guests have shared about their stay.
          </p>

          <div class="swiper reviewsSwiper" data-aos="fade-up">
            <div class="swiper-wrapper">
              <!-- Ejemplo de Review 1 -->
              <div class="swiper-slide review-slide">
                <img src="images/review1.png" alt="Guest review from Airbnb" />
                <div class="review-overlay">
                  <i class="fab fa-airbnb review-icon"></i>
                  <h3>"Highly recommend!"</h3>
                  <p>
                    "We had an incredible time at this lake condo! The view was
                    absolutely beautiful, and we enjoyed relaxing while taking
                    it all in. The host was very responsive and ensured that
                    everything we needed was available. When we requested to
                    change the thermostat schedule, Lilianny acted quickly and
                    accommodated our needs. The location was perfect for evening
                    strolls along the boardwalk, which made our stay even more
                    memorable. Highly recommend!"
                  </p>
                  <span>- October, 2024</span>
                </div>
              </div>

              <!-- Ejemplo de Review 2 -->
              <div class="swiper-slide review-slide">
                <img src="images/review2.png" alt="Guest review from Airbnb" />
                <div class="review-overlay">
                  <i class="fab fa-airbnb review-icon"></i>
                  <h3>"Definitely recommend it!"</h3>
                  <p>
                    "This place was very relaxing and had a beautiful view! The
                    hosts were great!"
                  </p>
                  <span>- February 2025</span>
                </div>
              </div>

              <!-- Ejemplo de Review 3 -->
              <div class="swiper-slide review-slide">
                <img src="images/review3.png" alt="Guest review from Airbnb" />
                <div class="review-overlay">
                  <i class="fab fa-airbnb review-icon"></i>
                  <h3>"Absolutely would recommend"</h3>
                  <p>
                    "Extremely clean and beautiful condo on Lake Norman. Very
                    well stocked with all necessities. Close to restaurants in
                    Davidson and just off the interstate. Located on a quiet
                    cove with walkable boardwalks on the lake. Our kids enjoyed
                    sitting on the patio in the morning and having breakfast
                    while we took in the lake views. Absolutely would recommend
                    and will be staying again in the future."
                  </p>
                  <span>- June 2024</span>
                </div>
              </div>

              <!-- Agrega más slides de reseña según necesites (review4.jpg, etc.) -->
            </div>
            <!-- Add Pagination -->
            <div class="swiper-pagination"></div>
            <!-- Add Navigation -->
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
          </div>

          <div class="view-more-reviews">
            <a
              href="https://www.airbnb.com.ec/rooms/732102319759567131/reviews?viralityEntryPoint=1&s=76&_set_bev_on_new_domain=1761410183_EAYzYyYjgyN2MxYW&source_impression_id=p3_1761586481_P3S3SGED0Ux4sxro&scroll_to_review=1434183809454874539"
              target="_blank"
              class="btn btn-secondary"
              >View All Reviews on Airbnb</a
            >
          </div>
        </div>
      </section>

      <section id="contact" class="reservation-section">
        <div class="container">
          <h2 class="section-title">Ready to Book Your Stay?</h2>
          <p>
            Use the calendar below to select your check-in and check-out dates.
            Our system will calculate the total for your stay.
          </p>
          <form id="booking-form">
            <div class="booking-widget">
              <input
                type="text"
                id="date-picker"
                name="dates"
                placeholder="Loading available dates..."
                readonly="readonly"
              />

              <div id="booking-summary" class="booking-summary-hidden">
                <div class="summary-item">
                  <span
                    >$<span id="price-per-night">150</span> x
                    <span id="night-count">0</span> nights</span
                  >
                  <span id="subtotal-price">$0</span>
                </div>
                <div class="summary-total">
                  <span>Total</span>
                  <span id="total-price">$0</span>
                </div>
                <button type="submit" class="btn btn-primary">
                  Request to Book
                </button>
              </div>
            </div>
          </form>
        </div>
      </section>
    </main>

    <footer>
      <div class="container">
        <p>
          &copy; <span id="year"></span> Lakeside Serenity Davidson. All rights
          reserved.
        </p>
      </div>
    </footer>

    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script src="https://js.stripe.com/v3/"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- INICIALIZACIÓN CON STRIPE ---
        const stripe = Stripe(
          "pk_test_51SAEbmGtWaCmr4GY08ZH8Drdy2yodu45r54CO0EJtxtWbrq1oqrR7Iv9Yj4v8xghmdhvFxCg5MtEwDToGZxXGqr300AW9Kr4hH"
        );
        // --- INICIALIZACIÓN GENERAL ---
        const yearSpan = document.getElementById("year");
        if (yearSpan) {
          yearSpan.textContent = new Date().getFullYear();
        }

        const header = document.querySelector("header");
        if (header) {
          window.addEventListener("scroll", () => {
            header.classList.toggle("scrolled", window.scrollY > 50);
          });
        }

        AOS.init({ duration: 800, once: true, offset: 50 });

        // --- SWIPER ---
        const swiperEl = document.querySelector(".mySwiper");
        if (swiperEl) {
          new Swiper(swiperEl, {
            loop: true,
            pagination: { el: ".swiper-pagination", clickable: true },
            navigation: {
              nextEl: ".swiper-button-next",
              prevEl: ".swiper-button-prev",
            },
          });
        }

        // --- SISTEMA DE RESERVAS ---
        const calendarInput = document.querySelector("#date-picker");
        if (calendarInput) {
          const pricePerNight = 140;
          const bookingSummaryEl = document.getElementById("booking-summary");
          const nightCountEl = document.getElementById("night-count");
          const pricePerNightEl = document.getElementById("price-per-night");
          const subtotalPriceEl = document.getElementById("subtotal-price");
          const totalPriceEl = document.getElementById("total-price");
          const bookingForm = document.getElementById("booking-form");
          let currentSelection = { checkIn: null, checkOut: null };

          async function initializeCalendar() {
            try {
              const response = await fetch("/api/bookings");
              const bookedDates = await response.json();

              flatpickr(calendarInput, {
                mode: "range",
                dateFormat: "Y-m-d",
                minDate: "today",
                disable: bookedDates,

                disable: [
                  function (date) {
                    // Convierte la fecha actual del calendario a formato YYYY-MM-DD
                    const dateStr =
                      date.getFullYear() +
                      "-" +
                      ("0" + (date.getMonth() + 1)).slice(-2) +
                      "-" +
                      ("0" + date.getDate()).slice(-2);

                    // Revisa si la fecha está dentro de algún rango reservado
                    for (const range of bookedDates) {
                      if (dateStr >= range.from && dateStr <= range.to) {
                        return true; // Si está, deshabilítala (devuelve true)
                      }
                    }
                    return false; // Si no, habilítala (devuelve false)
                  },
                ],

                onClose: function (selectedDates) {
                  if (selectedDates.length === 2) {
                    const checkIn = selectedDates[0];
                    const checkOut = selectedDates[1];
                    const nights = Math.ceil(
                      (checkOut - checkIn) / (1000 * 3600 * 24)
                    );

                    if (nights > 0) {
                      currentSelection.checkIn = checkIn
                        .toISOString()
                        .split("T")[0];
                      currentSelection.checkOut = checkOut
                        .toISOString()
                        .split("T")[0];

                      pricePerNightEl.textContent = pricePerNight;
                      nightCountEl.textContent = nights;
                      const subtotal = nights * pricePerNight;
                      subtotalPriceEl.textContent = `$${subtotal}`;
                      totalPriceEl.textContent = `$${subtotal}`; // Asumiendo que no hay otros cargos

                      bookingSummaryEl.classList.remove(
                        "booking-summary-hidden"
                      );
                    }
                  } else {
                    bookingSummaryEl.classList.add("booking-summary-hidden");
                  }
                },
              });
              calendarInput.placeholder = "Select your dates...";
            } catch (error) {
              console.error("Error loading booking dates:", error);
              calendarInput.placeholder =
                "Error loading dates. Please refresh.";
            }
          }

          bookingForm.addEventListener("submit", async (event) => {
            event.preventDefault();
            const submitButton = bookingForm.querySelector("button");
            submitButton.disabled = true;
            submitButton.textContent = "Redirecting to payment...";

            if (!currentSelection.checkIn || !currentSelection.checkOut) {
              alert("Please select a valid date range first.");
              submitButton.disabled = false;
              submitButton.textContent = "Request to Book";
              return;
            }

            const nights = Math.ceil(
              (new Date(currentSelection.checkOut) -
                new Date(currentSelection.checkIn)) /
                (1000 * 3600 * 24)
            );

            try {
              const response = await fetch("/api/create-checkout-session", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  nights: nights,
                  pricePerNight: pricePerNight,
                  checkIn: currentSelection.checkIn,
                  checkOut: currentSelection.checkOut,
                }),
              });
              const session = await response.json();

              if (session.error) {
                throw new Error(session.error.message);
              }

              // PASO 2: Guardar las fechas temporalmente en el navegador

              localStorage.setItem(
                "pending_booking_checkIn",
                currentSelection.checkIn
              );
              localStorage.setItem(
                "pending_booking_checkOut",
                currentSelection.checkOut
              );

              // PASO 3: Redirigir al usuario a la página de pago de Stripe
              const result = await stripe.redirectToCheckout({
                sessionId: session.id,
              });

              if (result.error) {
                throw new Error(result.error.message);
              }
            } catch (error) {
              console.error("Error initiating payment:", error);
              alert("There was an error. Please try again.");
              submitButton.disabled = false;
              submitButton.textContent = "Request to Book";
            }
          });

          initializeCalendar();
        }
        // --- NUEVO: LÓGICA DEL MENÚ HAMBURGUESA ---
        const navMenu = document.getElementById("nav-menu-mobile");
        const navToggle = document.getElementById("nav-toggle");
        const navClose = document.getElementById("nav-close");
        const navLinks = document.querySelectorAll(".nav-link-mobile");

        // Función para mostrar el menú
        if (navToggle) {
          navToggle.addEventListener("click", () => {
            navMenu.classList.add("show-menu");
          });
        }

        // Función para ocultar el menú
        if (navClose) {
          navClose.addEventListener("click", () => {
            navMenu.classList.remove("show-menu");
          });
        }
        // Función para cerrar el menú al hacer clic en un enlace
        navLinks.forEach((link) => {
          link.addEventListener("click", () => {
            navMenu.classList.remove("show-menu");
          });
        });
      });
    </script>
  </body>
</html>
